<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Carte Géologique de Montréal</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.21/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.21/"></script>
    <style>
        :root {
            --primary-color: #00549A;
            --secondary-color: #005396;
        }
        html, body {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            background: white;
        }

        h1 {
            font-size: 2em;
            animation: fadeIn 1s;
            color: white;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                font-size: 4rem;
            }
            to {
                opacity: 1;
                font-size: 2rem;
            }
        }

        .navbar {
            z-index: 1000;
            width: 100%;
            background: var(--primary-color);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding: 10px 30px;
            box-sizing: border-box;
            height: 100px;
            position: fixed;
            top: 0;
            color: white;
        }
        .navbar img {
            max-height: 120px;
            max-width: 150px;
        }

        .navbar svg {
            max-height: 120px;
            max-width: 150px;
        }
        #viewDiv {
            position: absolute;
            top: 100px; /* Height of the navbar */
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
<div class="navbar">
    <img class="logo" src="https://mma.prnewswire.com/media/1482181/Pomerleau_Inc__Pomerleau_et_la_Factry_annoncent_la_cr_ation_du_a_2.jpg?w=400" alt="Pomerleau">
    <h1>POC Arcgis JS</h1>
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
             viewBox="0 0 169 32" style="enable-background:new 0 0 169 32;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#fff;}
</style>
            <g>
	<g>
		<path class="st0" d="M163.5,0.1v31.8h5.5V0.1H163.5z M110.8,0.3c-8.2,0-14.8,6.6-15.3,14.8c0,0,0,1.3,0,1.4v15.2h5.5V16.9
			c0,0,0,0,0,0v-1.6c0.4-5.2,4.7-9.4,9.9-9.4c5.2,0,9.5,4.2,9.8,9.4c0,0.1,0,1.3,0,1.3v11.6l0,0v3.5h5.5l0-16.7
			C125.6,6.8,119,0.3,110.8,0.3z M48.9,26.2c-5.5,0-9.9-4.6-9.9-10.2c0-5.6,4.4-10.2,9.9-10.2c3.4,0,6.3,1.7,8.1,4.4l3.9-4
			c-2.8-3.6-7.1-6-12-6c-8.5,0-15.4,7.1-15.4,15.8c0,8.7,6.9,15.8,15.4,15.8c4.9,0,9.3-2.4,12.1-6.1l-3.9-4
			C55.3,24.4,52.3,26.2,48.9,26.2z M92.6,12.4C91.3,6.7,87.1,2,81.3,0.6C73-1.5,64.7,3.7,62.7,12.2c-0.2,0.7-0.3,1.4-0.4,2.1
			c0,0,0,0,0,0.1c0,0.2,0,0.5,0,0.7c0,0.1,0,0.1,0,0.2c0,0.2,0,0.4,0,0.5c0,0.1,0,0.2,0,0.2c0,0,0,0.1,0,0.1c0,0.1,0,0.2,0,0.3
			c0.2,8.6,7,15.5,15.4,15.5c4.9,0,9.3-2.4,12.1-6.1l-3.9-4c-0.2,0.3-0.4,0.6-0.7,0.9l0,0c-2.3,2.8-6.1,4.2-9.8,3.3
			c-3-0.8-5.3-2.8-6.6-5.5l24.1-6.4L92.6,12.4z M67.8,15.3c0-0.2,0-0.4,0.1-0.6c0.7-5,4.8-8.8,9.8-8.8c3.4,0,6.3,1.7,8.1,4.4l0,0
			c0.1,0.2,0.3,0.4,0.4,0.6L67.8,15.3z M15.4,0C6.9,0,0,7.1,0,15.9c0,8.8,6.9,15.9,15.4,15.9c2.7,0,5.3-0.7,7.5-2v-0.1l-4.1-4.2
			c-1.1,0.4-2.2,0.6-3.5,0.6c-5.5,0-9.9-4.6-9.9-10.2c0-5.6,4.4-10.2,9.9-10.2c5.5,0,9.9,4.6,9.9,10.2c0,0.2,0,0.4,0,0.6V28
			c0,0,0,0,0,0v4h5.5V16.3h0c0-0.1,0-0.3,0-0.4C30.8,7.1,23.9,0,15.4,0z M144.2,5.8c3.7-0.1,7,2,8.7,5.1l4.7-2.9
			c-2.7-4.8-7.8-7.9-13.5-7.8c-8.5,0.1-15.3,7.3-15.1,16.1c0,0.4,0.1,2.1,0.1,2.1l24.9,0c-1,4.4-4.8,7.7-9.4,7.8
			c-3.7,0.1-6.9-1.9-8.7-5l0,0l0.1,0.2l-4.7,2.9c2.8,4.6,7.7,7.7,13.4,7.6c8.1-0.1,14.6-6.6,15.1-14.8l0-3.4l-25,0
			C135.7,9.2,139.5,5.9,144.2,5.8z"/>
	</g>
</g>
</svg>
</div>
<div id="viewDiv"></div>
<script>
    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GraphicsLayer",
        "esri/widgets/Sketch",
        "esri/Graphic"
    ], function(Map, MapView, GraphicsLayer, Sketch, Graphic) {

        var map = new Map({
            basemap: "topo-vector"
        });

        var view = new MapView({
            container: "viewDiv",
            map: map,
            center: [-73.5673, 45.5017], // Longitude, latitude de Montréal
            zoom: 10
        });

        var graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);

        // Ajouter un point par défaut pour la carrière de pierre de Saint-Bruno
        var quarryPoint = {
            type: "point",
            longitude: -73.332,
            latitude: 45.535
        };

        var quarrySymbol = {
            type: "simple-marker",
            color: [226, 119, 40],
            outline: {
                color: [255, 255, 255],
                width: 2
            }
        };

        var quarryPopupTemplate = {
            title: "Carrière de Pierre de Saint-Bruno",
            content: getGeologicalInfo()
        };

        var quarryGraphic = new Graphic({
            geometry: quarryPoint,
            symbol: quarrySymbol,
            popupTemplate: quarryPopupTemplate
        });

        graphicsLayer.add(quarryGraphic);

        var sketch = new Sketch({
            view: view,
            layer: graphicsLayer,
            creationMode: "update"
        });

        view.ui.add(sketch, "top-right");

        sketch.on("create", function(event) {
            if (event.state === "complete") {
                var geometry = event.graphic.geometry;
                var randomInfo = getGeologicalInfo();

                var popupTemplate = {
                    title: "Informations Géologiques",
                    content: randomInfo
                };

                var graphic = new Graphic({
                    geometry: geometry,
                    symbol: event.graphic.symbol,
                    popupTemplate: popupTemplate
                });

                graphicsLayer.remove(event.graphic);
                graphicsLayer.add(graphic);

                view.popup.open({
                    location: event.graphic.geometry.type === "point" ? event.graphic.geometry : event.graphic.geometry.extent.center,
                    features: [graphic]
                });
            }
        });

        view.on("click", function(event) {
            view.hitTest(event).then(function(response) {
                if (response.results.length) {
                    var graphic = response.results.filter(function(result) {
                        return result.graphic.layer === graphicsLayer;
                    })[0].graphic;

                    if (graphic) {
                        view.popup.open({
                            location: event.mapPoint,
                            features: [graphic]
                        });
                    }
                }
            });
        });

        function getGeologicalInfo() {
            var info = [
                "<b>Type de sol :</b> Argile<br><b>Profondeur :</b> 10 mètres<br><b>Qualité :</b> Moyenne<br><b>Réserves Estimées :</b> 500 000 m3<br><b>Éléments trouvés :</b> Fer, Cuivre, Or",
                "<b>Type de sol :</b> Sable<br><b>Profondeur :</b> 20 mètres<br><b>Qualité :</b> Haute<br><b>Réserves Estimées :</b> 1 million m3<br><b>Éléments trouvés :</b> Argent, Plomb, Zinc",
                "<b>Type de sol :</b> Calcaire<br><b>Profondeur :</b> 15 mètres<br><b>Qualité :</b> Faible<br><b>Réserves Estimées :</b> 750 000 m3<br><b>Éléments trouvés :</b> Or, Fer, Nickel"
            ];
            return info[Math.floor(Math.random() * info.length)];
        }
    });
</script>
</body>
</html>
